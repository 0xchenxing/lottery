<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬äº”å±Šæ¹¾åŒºå…ƒå®‡å®™å¤§ä¼š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e, #4a148c, #880e4f);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background-color: rgba(0, 0, 0, 0.75);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
        
        .logo-container {
            margin-right: 20px;
        }
        
        .logo-container img {
            max-width: 150px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #00e5ff, #2979ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin: 0;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .content {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: none;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            color: #80deea;
        }
        
        textarea, input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 2px solid #2979ff;
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: monospace;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: #00e5ff;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
        }
        
        .input-hint {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
            color: #b3e5fc;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 1rem;
            color: #80deea;
        }
        
        .button-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        button {
            padding: 16px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        #drawButton {
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
        }
        
        #drawButton:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 114, 255, 0.4);
        }
        
        #resetButton {
            background: linear-gradient(to right, #7b1fa2, #4a148c);
            color: white;
        }
        
        #resetButton:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(123, 31, 162, 0.4);
        }
        
        .export-button {
            padding: 10px 20px;
            font-size: 1rem;
            background: linear-gradient(to right, #ff9800, #f57c00);
            color: white;
            margin-bottom: 15px;
        }
        
        .export-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(245, 124, 0, 0.4);
        }
        
        .history-section h2 {
            display: inline-block;
            margin-right: 15px;
        }
        
        .result-section {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h2 {
            font-size: 1.8rem;
            color: #80deea;
        }
        
        /* å·²ç§»é™¤ç»“æœæ•°é‡æ˜¾ç¤ºæ ·å¼ */
        
        .result-container {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            min-height: 200px;
            padding: 25px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            align-content: flex-start;
        }
        
        .result-number {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 110px;
            height: 90px;
            background: linear-gradient(135deg, #1a237e, #311b92);
            border-radius: 15px;
            font-size: 1.8rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: popIn 0.5s ease-out forwards;
            opacity: 0;
            transform: scale(0.5);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        
        /* æ‰‹æœºå›¾æ ‡æ ·å¼ */
        .phone-icon {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        /* æ•°å­—æ–‡æœ¬æ ·å¼ */
        .number-text {
            font-size: 1.2em;
            font-weight: bold;
            transition: transform 0.1s ease, color 0.1s ease;
            letter-spacing: 1px;
            text-align: center;
        }
        
        /* æ•°å­—æ»šåŠ¨åŠ¨ç”» */
        .result-number:not(.final-result) .number-text {
            animation: roll 0.1s linear infinite;
        }
        
        /* æœ€ç»ˆç»“æœé«˜äº®æ•ˆæœ */
        .result-number.final-result {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(255, 107, 107, 0.4);
        }
        
        /* æ•°å­—æ»šåŠ¨åŠ¨ç”» */
        @keyframes roll {
            0% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(-2px); opacity: 0.8; }
            100% { transform: translateY(2px); opacity: 1; }
        }
        
        .result-number::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #00e5ff, #2979ff);
        }
        
        .result-number.highlight {
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 198, 255, 0.7);
        }
        
        .result-number .phone-icon {
            font-size: 1rem;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        @keyframes popIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .history-section {
            margin-top: 30px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            display: none; /* éšè—æŠ½å¥–å†å²è®°å½• */
        }
        
        .history-container {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            margin-top: 15px;
        }
        
        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 5px solid #00e5ff;
        }
        
        .history-item span {
            font-weight: bold;
            color: #00e5ff;
        }
        

        
        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9rem;
            opacity: 0.7;
            color: #b3e5fc;
        }
        
        /* å›¾ç‰‡å±•ç¤ºåŒºåŸŸæ ·å¼ */
        .images-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .image-container {
            flex: 0 0 auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .image-container:hover {
            transform: translateY(-5px);
        }

        .image-container img {
            width: 450px;
            height: auto;
            object-fit: contain;
            display: block;
            background-color: transparent;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .content {
                flex-direction: column;
            }
            
            .button-section {
                flex-direction: column;
            }
            
            .result-number {
                width: 95px;
                height: 80px;
                font-size: 1.4rem;
            }
            
            /* æ•°å­—æ–‡æœ¬æ ·å¼ - å°å±å¹• */
            .result-number .number-text {
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .result-number {
                width: 85px;
                height: 70px;
                font-size: 1.2rem;
            }
            
            .result-container {
                gap: 10px;
                padding: 15px;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - å›¾ç‰‡åŒºåŸŸ */
        @media (max-width: 768px) {
            .images-section {
                flex-direction: column;
                gap: 15px;
            }

            .image-container {
                max-width: 100%;
            }
            
            .image-container img {
                width: 100%;
                height: auto;
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="./logo.png" alt="ç¬¬äº”å±Šæ¹¾åŒºå…ƒå®‡å®™å¤§ä¼šLogo">
            </div>
            <h1>ç¬¬äº”å±Šæ¹¾åŒºå…ƒå®‡å®™å¤§ä¼š</h1>
        </header>
        
        <!-- å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
        <div class="images-section">
            <div class="image-container">
                <img src="./1.jpg" alt="å¤§ä¼šå›¾ç‰‡1">
            </div>
            <div class="image-container">
                <img src="./2.jpg" alt="å¤§ä¼šå›¾ç‰‡2">
            </div>
        </div>
        
        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label for="phoneNumbers">æ‰‹æœºå°¾å·åˆ—è¡¨</label>
                    <textarea id="phoneNumbers" placeholder="è¯·è¾“å…¥æ‰‹æœºå°¾å·ï¼Œæ¯è¡Œä¸€ä¸ªæˆ–ç”¨é€—å·åˆ†éš”&#10;ä¾‹å¦‚ï¼š&#10;12345&#10;56789&#10;90123&#10;34567"></textarea>
                    <div class="stats">
                        <div>æœ‰æ•ˆå°¾å·æ•°: <span id="validCount">0</span></div>
                        <div>é‡å¤å°¾å·æ•°: <span id="duplicateCount">0</span></div>
                    </div>
                    <div class="input-hint">è¯·è¾“å…¥5ä½æ•°å­—çš„æ‰‹æœºå°¾å·ï¼ˆå¦‚ï¼š12345ï¼‰ï¼Œæ¯è¡Œä¸€ä¸ªæˆ–ç”¨é€—å·åˆ†éš”</div>
                </div>
                
                <div class="input-group">
                    <label for="drawCount">æŠ½å–æ•°é‡</label>
                    <input type="number" id="drawCount" min="1" max="50" value="30" placeholder="è¯·è¾“å…¥è¦æŠ½å–çš„å°¾å·æ•°é‡">
                    <div class="input-hint">æœ€å¤šå¯æŠ½å–50ä¸ªå°¾å·ï¼Œä¸”ä¸èƒ½è¶…è¿‡è¾“å…¥çš„å°¾å·æ€»æ•°</div>
                </div>
                
                <div class="input-group">
                    <label for="excludeNumbers">æ’é™¤å°¾å·ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="excludeNumbers" placeholder="è¾“å…¥è¦æ’é™¤çš„å°¾å·ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š12345,56789">
                    <div class="input-hint">è¿™äº›å°¾å·å°†ä¸ä¼šå‚ä¸æŠ½å¥–</div>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-header">
                    <h2>æŠ½å¥–ç»“æœ</h2>
                </div>
                <div class="result-container" id="resultContainer">
                    <!-- æŠ½å¥–ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    <div class="empty-result">ç­‰å¾…æŠ½å¥–...</div>
                </div>
                
                <div class="button-section">
                    <button id="drawButton">ğŸ¯ å¼€å§‹æŠ½å¥–</button>
                    <button id="stopButton" disabled>ğŸ›‘ åœæ­¢æŠ½å¥–</button>
                </div>
            </div>
        </div>
        
        <div class="history-section">
            <h2>ğŸ“œ æŠ½å¥–å†å²è®°å½•</h2>
            <button id="exportHistoryButton" class="export-button">å¯¼å‡ºå†å²è®°å½•</button>
            <div class="history-container" id="historyContainer">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                <div class="empty-history">æš‚æ— æŠ½å¥–è®°å½•</div>
            </div>
        </div>
        
        <footer>
            <p>ç¬¬äº”å±Šæ¹¾åŒºå…ƒå®‡å®™å¤§ä¼š &copy; 2025 | é‡‡ç”¨ Fisher-Yates æ´—ç‰Œç®—æ³•ç¡®ä¿éšæœºæ€§ | å°¾å·æ ¼å¼: XXXXX (5ä½æ•°å­—)</p>
        </footer>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const phoneNumbersInput = document.getElementById('phoneNumbers');
        const drawCountInput = document.getElementById('drawCount');
        const excludeNumbersInput = document.getElementById('excludeNumbers');
        const drawButton = document.getElementById('drawButton');
        const stopButton = document.getElementById('stopButton');
        const resetButton = document.getElementById('resetButton');
        const resultContainer = document.getElementById('resultContainer');
        // å·²ç§»é™¤æŠ½å–æ•°é‡æ˜¾ç¤ºå…ƒç´ 
        const historyContainer = document.getElementById('historyContainer');
        const validCountElement = document.getElementById('validCount');
        const duplicateCountElement = document.getElementById('duplicateCount');
        
        // åˆå§‹åŒ–å˜é‡
        let drawHistory = [];
        // ä»localStorageè¯»å–æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
        let drawnNumbers = JSON.parse(localStorage.getItem('drawnNumbers')) || [];
        let allPhoneNumbers = [];
        
        // æŠ½å¥–æ»šåŠ¨ç›¸å…³å˜é‡
        let isDrawing = false;
        let drawInterval = null;
        let currentResults = [];
        
        // è§£æè¾“å…¥çš„æ‰‹æœºå°¾å·
        function parsePhoneNumbers(input) {
            if (!input.trim()) return [];
            
            // æ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼šæ¢è¡Œã€é€—å·ã€ç©ºæ ¼
            const numbers = input.split(/[\n,ï¼Œ\s]+/)
                .map(num => num.trim())
                .filter(num => num.length > 0);
            
            return numbers;
        }
        
        // éªŒè¯æ‰‹æœºå°¾å·æ ¼å¼ï¼ˆ5ä½æ•°å­—ï¼‰
        function isValidPhoneTail(number) {
            return /^\d{5}$/.test(number);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const input = phoneNumbersInput.value;
            const parsedNumbers = parsePhoneNumbers(input);
            
            // ç»Ÿè®¡æœ‰æ•ˆå°¾å·
            const validNumbers = parsedNumbers.filter(isValidPhoneTail);
            
            // ç»Ÿè®¡é‡å¤å°¾å·
            const uniqueNumbers = [...new Set(validNumbers)];
            const duplicateCount = validNumbers.length - uniqueNumbers.length;
            
            validCountElement.textContent = validNumbers.length;
            duplicateCountElement.textContent = duplicateCount;
            
            return validNumbers;
        }
        
        // è¾“å…¥éªŒè¯
        function validateInputs() {
            const validNumbers = updateStats();
            const m = parseInt(drawCountInput.value);
            
            if (validNumbers.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå°¾å·ï¼ˆ5ä½æ•°å­—ï¼‰');
                phoneNumbersInput.focus();
                return false;
            }
            
            if (isNaN(m) || m < 1 || m > 100) {
                alert('æŠ½å–æ•°é‡å¿…é¡»æ˜¯1-100ä¹‹é—´çš„æ•´æ•°');
                drawCountInput.focus();
                return false;
            }
            
            if (m > validNumbers.length) {
                alert(`æŠ½å–æ•°é‡(${m})ä¸èƒ½è¶…è¿‡æœ‰æ•ˆå°¾å·æ€»æ•°(${validNumbers.length})`);
                drawCountInput.focus();
                return false;
            }
            
            return true;
        }
        
        // è§£ææ’é™¤çš„å°¾å·
        function parseExcludeNumbers() {
            if (!excludeNumbersInput.value.trim()) return [];
            
            return excludeNumbersInput.value.split(/[,ï¼Œ\s]+/)
                .map(num => num.trim())
                .filter(num => isValidPhoneTail(num));
        }
        
        // Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // æŠ½å–éšæœºå°¾å·
        function drawRandomNumbers(validNumbers, m) {
            // å»é‡
            let uniqueNumbers = [...new Set(validNumbers)];
            
            // æ’é™¤æŒ‡å®šçš„å°¾å·
            const excludeNumbers = parseExcludeNumbers();
            uniqueNumbers = uniqueNumbers.filter(num => !excludeNumbers.includes(num));
            
            if (m > uniqueNumbers.length) {
                alert(`æ’é™¤æŒ‡å®šå°¾å·åï¼Œå¯ç”¨å°¾å·æ•°é‡(${uniqueNumbers.length})ä¸è¶³ï¼Œæ— æ³•æŠ½å–${m}ä¸ªå°¾å·`);
                return [];
            }
            
            // æ´—ç‰Œå¹¶æŠ½å–
            const shuffled = shuffleArray([...uniqueNumbers]);
            return shuffled.slice(0, m).sort((a, b) => a.localeCompare(b, undefined, {numeric: true}));
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResults(results) {
            resultContainer.innerHTML = '';
            
            if (results.length === 0) {
                resultContainer.innerHTML = '<div class="empty-result">ç­‰å¾…æŠ½å¥–...</div>';
                // å·²ç§»é™¤æŠ½å–æ•°é‡æ˜¾ç¤º
                return;
            }
            
            results.forEach((number, index) => {
                const numberElement = document.createElement('div');
                numberElement.className = 'result-number';
                numberElement.style.animationDelay = `${index * 0.1}s`;
                
                // æ·»åŠ æ‰‹æœºå›¾æ ‡
                const phoneIcon = document.createElement('div');
                phoneIcon.className = 'phone-icon';
                phoneIcon.textContent = 'ğŸ“±';
                
                // æ·»åŠ å°¾å·
                const numberText = document.createElement('div');
                numberText.textContent = number;
                

                
                // æ‰€æœ‰æŠ½ä¸­çš„å·ç éƒ½æ·»åŠ é«˜äº®æ•ˆæœ
                numberElement.classList.add('highlight');
                
                numberElement.appendChild(phoneIcon);
                numberElement.appendChild(numberText);
                resultContainer.appendChild(numberElement);
            });
            
            // å·²ç§»é™¤æŠ½å–æ•°é‡æ˜¾ç¤º
        }
        
        // æ·»åŠ å†å²è®°å½•
        function addToHistory(validNumbersCount, m, results) {
            // ç¡®ä¿å†å²è®°å½•å®¹å™¨å­˜åœ¨
            const container = document.getElementById('historyContainer');
            if (!container) {
                console.error('å†å²è®°å½•å®¹å™¨ä¸å­˜åœ¨');
                return;
            }
            
            // ä¿å­˜åˆ°å†å²è®°å½•æ•°ç»„
            const timestamp = new Date().toLocaleString();
            drawHistory.push({
                timestamp: timestamp,
                totalNumbers: validNumbersCount,
                drawCount: m,
                results: [...results]
            });
            
            // ç§»é™¤ç©ºå†å²è®°å½•æç¤º
            const emptyHistory = container.querySelector('.empty-history');
            if (emptyHistory) {
                container.removeChild(emptyHistory);
            }
            
            // åˆ›å»ºå†å²è®°å½•å…ƒç´ 
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            // è®¾ç½®å†å²è®°å½•å†…å®¹
            historyItem.innerHTML = `
                <strong>${timestamp}</strong> - 
                ä» ${validNumbersCount} ä¸ªæœ‰æ•ˆå°¾å·ä¸­æŠ½å–äº† ${m} ä¸ªå°¾å·: 
                <strong>${results.join(', ')}</strong>
            `;
            
            // æ·»åŠ åˆ°å†å²è®°å½•å®¹å™¨çš„é¡¶éƒ¨
            container.insertBefore(historyItem, container.firstChild);
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡ä¸º10æ¡
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
            
            // é™åˆ¶æ•°ç»„é•¿åº¦ä¸º10æ¡
            if (drawHistory.length > 10) {
                drawHistory.shift();
            }
        }
        
        // æ‰§è¡ŒæŠ½å¥–
        function performDraw() {
            console.log('å¼€å§‹æ‰§è¡ŒæŠ½å¥–');
            if (!validateInputs()) {
                console.log('è¾“å…¥éªŒè¯å¤±è´¥');
                return;
            }
            
            const validNumbers = updateStats();
            const m = parseInt(drawCountInput.value);
            
            console.log('éªŒè¯é€šè¿‡ï¼Œæœ‰æ•ˆå°¾å·æ•°é‡:', validNumbers.length, 'æŠ½å–æ•°é‡:', m);
            
            // æ˜¾ç¤ºæŠ½å¥–çŠ¶æ€
            drawButton.textContent = 'æŠ½å¥–ä¸­...';
            drawButton.disabled = true;
            stopButton.disabled = false;
            
            isDrawing = true;
            
            // å»é‡å¹¶æ’é™¤æŒ‡å®šå°¾å·
            let uniqueNumbers = [...new Set(validNumbers)];
            const excludeNumbers = parseExcludeNumbers();
            uniqueNumbers = uniqueNumbers.filter(num => !excludeNumbers.includes(num));
            
            if (m > uniqueNumbers.length) {
                alert(`æ’é™¤æŒ‡å®šå°¾å·åï¼Œå¯ç”¨å°¾å·æ•°é‡(${uniqueNumbers.length})ä¸è¶³ï¼Œæ— æ³•æŠ½å–${m}ä¸ªå°¾å·`);
                drawButton.textContent = 'ğŸ¯ å¼€å§‹æŠ½å¥–';
                drawButton.disabled = false;
                stopButton.disabled = true;
                return;
            }
            
            // ç”Ÿæˆæœ€ç»ˆç»“æœï¼ˆä½†ä¸ç«‹å³æ˜¾ç¤ºï¼‰
            const finalResults = drawRandomNumbers(validNumbers, m);
            currentResults = finalResults;
            
            // åˆ›å»ºæ»šåŠ¨å®¹å™¨
            resultContainer.innerHTML = '';
            // å·²ç§»é™¤æŠ½å–æ•°é‡æ˜¾ç¤º
            
            // åˆ›å»ºæ‰€æœ‰å·ç å…ƒç´ 
            const numberElements = [];
            for (let i = 0; i < m; i++) {
                const numberElement = document.createElement('div');
                numberElement.className = 'result-number';
                numberElement.style.animationDelay = `${i * 0.1}s`;
                
                // æ·»åŠ æ‰‹æœºå›¾æ ‡
                const phoneIcon = document.createElement('div');
                phoneIcon.className = 'phone-icon';
                phoneIcon.textContent = 'ğŸ“±';
                
                // æ·»åŠ å°¾å·
                const numberText = document.createElement('div');
                numberText.className = 'number-text';
                numberText.textContent = '----';
                
                numberElement.appendChild(phoneIcon);
                numberElement.appendChild(numberText);
                resultContainer.appendChild(numberElement);
                numberElements.push(numberElement);
            }
            
            // å¼€å§‹æ•°å­—æ»šåŠ¨æ•ˆæœ
            drawInterval = setInterval(() => {
                // ä¸ºæ¯ä¸ªå·ç ç‹¬ç«‹ç”Ÿæˆéšæœºæ•°å­—
                numberElements.forEach((element, index) => {
                    // ä»å¯ç”¨å·ç ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
                    const randomIndex = Math.floor(Math.random() * uniqueNumbers.length);
                    const numberText = element.querySelector('.number-text');
                    if (numberText) {
                        numberText.textContent = uniqueNumbers[randomIndex];
                    }
                });
            }, 100);
        }
        
        // åœæ­¢æŠ½å¥–
        function stopDraw() {
        if (!isDrawing) return;
        
        console.log('åœæ­¢æŠ½å¥–');
        
        // æ¸…é™¤å®šæ—¶å™¨
        clearInterval(drawInterval);
        drawInterval = null;
        isDrawing = false;
        
        // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
        const finalResults = currentResults;
        console.log('æœ€ç»ˆæŠ½å¥–ç»“æœ:', finalResults);
        
        // ç›´æ¥æ›´æ–°ç°æœ‰å…ƒç´ æ˜¾ç¤ºæœ€ç»ˆç»“æœï¼Œé¿å…é‡æ–°åˆ›å»º
        const numberElements = resultContainer.querySelectorAll('.result-number');
        finalResults.forEach((number, index) => {
            if (index < numberElements.length) {
                const numberText = numberElements[index].querySelector('.number-text');
                if (numberText) {
                    numberText.textContent = number;
                    numberElements[index].classList.add('final-result');
                }
            }
        });
        
        // æ·»åŠ å†å²è®°å½•
        const validNumbers = updateStats();
        const m = parseInt(drawCountInput.value);
        addToHistory(validNumbers.length, m, finalResults);
        
        // å°†æœ¬æ¬¡æŠ½ä¸­çš„å·ç æ·»åŠ åˆ°å·²æŠ½è¿‡çš„å·ç åˆ—è¡¨
        drawnNumbers.push(...finalResults);
        
        // ä»æ‰‹æœºå°¾å·åˆ—è¡¨ä¸­åˆ é™¤å·²æŠ½ä¸­çš„å·ç 
        const currentNumbers = parsePhoneNumbers(phoneNumbersInput.value);
        const remainingNumbers = currentNumbers.filter(num => !finalResults.includes(num));
        phoneNumbersInput.value = remainingNumbers.join('\n');
        
        // ä¿å­˜æ›´æ–°åçš„å·ç åˆ—è¡¨å’Œå·²æŠ½å¥–å·ç åˆ°localStorage
        localStorage.setItem('phoneNumbers', phoneNumbersInput.value);
        localStorage.setItem('drawnNumbers', JSON.stringify(drawnNumbers));
        
        // æ’­æ”¾æç¤ºéŸ³
        playDrawSound();
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStats();
        
        // æŠ½å¥–ç»“æŸåè‡ªåŠ¨å¯¼å‡ºå†å²è®°å½•
        setTimeout(() => {
            exportHistory();
        }, 500);
        
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        drawButton.textContent = 'ğŸ¯ å¼€å§‹æŠ½å¥–';
        drawButton.disabled = false;
        stopButton.disabled = true;
    }
        
        // æ’­æ”¾æŠ½å¥–éŸ³æ•ˆ
        function playDrawSound() {
            try {
                // åˆ›å»ºç®€å•çš„éŸ³æ•ˆ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // å¦‚æœéŸ³é¢‘APIä¸å¯ç”¨ï¼Œé™é»˜å¤±è´¥
                console.log("éŸ³é¢‘APIä¸å¯ç”¨");
            }
        }

        
        // å¯¼å‡ºå†å²è®°å½•åŠŸèƒ½
        function exportHistory() {
            if (drawHistory.length === 0) {
                alert('æš‚æ— æŠ½å¥–å†å²è®°å½•å¯å¯¼å‡º');
                return;
            }
            
            // æ„å»ºå¯¼å‡ºå†…å®¹
            let exportContent = 'ğŸ“œ æ‰‹æœºå°¾å·æŠ½å¥–å†å²è®°å½•\n';
            exportContent += '='.repeat(50) + '\n\n';
            
            drawHistory.forEach((record, index) => {
                exportContent += `æŠ½å¥–ç¼–å·: ${drawHistory.length - index}\n`;
                exportContent += `æŠ½å¥–æ—¶é—´: ${record.timestamp}\n`;
                exportContent += `æœ‰æ•ˆå°¾å·æ€»æ•°: ${record.totalNumbers}\n`;
                exportContent += `æŠ½å–æ•°é‡: ${record.drawCount}\n`;
                exportContent += `ä¸­å¥–å°¾å·: ${record.results.join(', ')}\n`;
                exportContent += '-'.repeat(50) + '\n';
            });
            
            // åˆ›å»ºBlobå¯¹è±¡
            const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const downloadLink = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const filename = `æŠ½å¥–å†å²è®°å½•_${new Date().toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).replace(/[/:]/g, '')}.txt`;
            
            downloadLink.href = url;
            downloadLink.download = filename;
            
            // æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½
            document.body.appendChild(downloadLink);
            downloadLink.click();
            
            // æ¸…ç†
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(url);
        }
        
        // äº‹ä»¶ç›‘å¬
        drawButton.addEventListener('click', performDraw);
        stopButton.addEventListener('click', stopDraw);
        
        // ä¸ºå¯¼å‡ºæŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
        const exportHistoryButton = document.getElementById('exportHistoryButton');
        if (exportHistoryButton) {
            exportHistoryButton.addEventListener('click', exportHistory);
        }
        
        // å®æ—¶æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        phoneNumbersInput.addEventListener('input', updateStats);
        excludeNumbersInput.addEventListener('input', updateStats);
        

        
        // æŒ‰Enteré”®è§¦å‘æŠ½å¥–
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey) && !drawButton.disabled) {
                performDraw();
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // ä»localStorageè¯»å–ä¿å­˜çš„å·ç åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
            const savedNumbers = localStorage.getItem('phoneNumbers');
            const defaultNumbers = [
                // ç¤ºä¾‹å·ç ï¼šç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ /ä¿®æ”¹æ‰€æœ‰å·ç 
                "12345", "56789", "90123", "34567", "78901",
                "23456", "67890", "01234", "45678", "89012",
                "11111", "22222", "33333", "44444", "55555",
                "66666", "77777", "88888", "99999", "00000",
                "13579", "24680", "15935", "26842", "35791",
                "14702", "25803", "36904", "45612", "78923",
                "32109", "65432", "98765", "31415", "59265",
                "53589", "97932", "23581", "16180", "27182",
                "31425", "57721", "12123", "34345", "56567",
                "78789", "90901", "13135", "24246", "35357",
                "46468", "57579", "68680", "79791", "80802",
                "12486", "24968", "36249", "48321", "50402",
                "62484", "74568", "86640", "98724", "10806",
                "21608", "32400", "43202", "54004", "64806"
            ];
            
            // ä½¿ç”¨ä¿å­˜çš„å·ç æˆ–é»˜è®¤å·ç 
            phoneNumbersInput.value = savedNumbers || defaultNumbers.join('\n');
            
            updateStats();
            
            // åˆå§‹æ˜¾ç¤º
            displayResults([]);
        });
    </script>
</body>
</html>